generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  STYLIST
  TECHNICIAN
  ASSISTANT
}

enum ServiceCategory {
  HAIR
  NAIL
  LASH
  PRODUCT
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  TRANSFER
  GOWABI
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum CommissionType {
  PERCENT
  FIXED
}

model User {
  id        String   @id @default(cuid())
  name      String
  role      Role
  pin       String?  // Simple PIN for POS access
  avatar    String?  // Avatar URL or preset ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Commission Settings
  commissionType CommissionType @default(PERCENT)
  commissionRate Decimal        @default(0)

  // Relations
  primaryTransactions   TransactionItem[] @relation("PrimaryStaff")
  assistantTransactions TransactionItem[] @relation("AssistantStaff")
  commissions           CommissionLog[]
  appointments          Appointment[]
}

model Customer {
  id        String   @id @default(cuid())
  name      String
  phone     String   @unique
  points    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  transactions Transaction[]
}

model Service {
  id          String          @id @default(cuid())
  name        String
  category    ServiceCategory
  price       Decimal
  durationMin Int             @default(30)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  transactionItems TransactionItem[]
  appointments     Appointment[]
}

model Transaction {
  id            String        @id @default(cuid())
  totalAmount   Decimal
  paymentMethod PaymentMethod
  note          String?       // For coupon codes or remarks
  createdAt     DateTime      @default(now())
  
  customerId    String?
  customer      Customer?     @relation(fields: [customerId], references: [id])

  items         TransactionItem[]
}

model TransactionItem {
  id            String   @id @default(cuid())
  price         Decimal  // Price at time of sale
  commissionAmount Decimal @default(0)
  
  transactionId String
  transaction   Transaction @relation(fields: [transactionId], references: [id])

  serviceId     String
  service       Service     @relation(fields: [serviceId], references: [id])

  // Commission tracking
  primaryStaffId String?
  primaryStaff   User?    @relation("PrimaryStaff", fields: [primaryStaffId], references: [id])

  assistantStaffId String?
  assistantStaff   User?   @relation("AssistantStaff", fields: [assistantStaffId], references: [id])

  commissionLogs CommissionLog[]
}

model CommissionLog {
  id                String   @id @default(cuid())
  amount            Decimal
  reason            String   // e.g., "10% Hair Service"
  createdAt         DateTime @default(now())

  staffId           String
  staff             User     @relation(fields: [staffId], references: [id])

  transactionItemId String
  transactionItem   TransactionItem @relation(fields: [transactionItemId], references: [id])
}

model Appointment {
  id              String            @id @default(cuid())
  customerName    String
  customerPhone   String
  scheduledAt     DateTime          // Date and time of appointment
  deposit         Decimal           @default(0)
  notes           String?
  status          AppointmentStatus @default(SCHEDULED)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  serviceId       String
  service         Service           @relation(fields: [serviceId], references: [id])
  
  staffId         String?
  staff           User?             @relation(fields: [staffId], references: [id])
}
